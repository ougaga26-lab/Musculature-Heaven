<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musculature Heaven</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #2c5f7c;
            --secondary: #8b4f4b;
            --accent: #d4a373;
            --success: #4caf50;
            --card: #ffffff;
            --text: #2a2a2a;
            --border: #d4cfc4;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f8f6f3 0%, #ebe8e1 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 1rem;
        }

        .container { max-width: 800px; margin: 0 auto; }

        /* â”€â”€â”€ æ¨™é¡Œ â”€â”€â”€ */
        .header { text-align: center; margin-bottom: 1.2rem; }
        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.2rem;
        }
        .subtitle { font-size: 0.95rem; color: var(--secondary); }

        /* â”€â”€â”€ ç¯©é¸å™¨ â”€â”€â”€ */
        .controls {
            background: var(--card);
            border-radius: 15px;
            padding: 0.8rem 1rem;       /* âœ… ç¸®çŸ­é¦–å± */
            margin-bottom: 0.9rem;      /* âœ… ç¸®çŸ­é¦–å± */
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        .filter-buttons {
            display: flex;
            gap: 0.6rem;
            width: 100%;
            align-items: center;
            flex-direction: column; /* âœ… æ‰‹æ©Ÿ/æ¡Œé¢éƒ½æ¡ä¸Šä¸‹ï¼šå­é¡åˆ¥åœ¨ä¸Šã€å…¨éƒ¨åœ¨ä¸‹ */
        }

        /* å­é¡åˆ¥ï¼ˆä½ è¦å…ˆå¯è¦‹çš„ï¼šé‚„ä¸ç†Ÿ/ç†Ÿæ‚‰äº†/é‚„æ²’çœ‹ï¼‰ */
        .filter-sub-group { display: flex; gap: 0.5rem; width: 100%; }

        .filter-btn {
            padding: 0.45rem 0.35rem;   /* âœ… ç¨å¾®è®Šæ‰ */
            border: 1.5px solid var(--border);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.12rem;
            flex: 1;
            min-width: 0;
        }
        .filter-btn .filter-label { font-size: 0.8rem; white-space: nowrap; }
        .filter-btn .filter-count { font-size: 0.68rem; color: #999; font-weight: 600; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .filter-btn.active .filter-count { color: rgba(255,255,255,0.7); }

        /* å…¨éƒ¨ï¼ˆç§»åˆ°ä¸‹é¢ï¼‰ */
        .filter-btn-all {
            width: 100%;
            padding: 0.55rem 1rem;     /* âœ… è®Šæ‰ */
            border: 2px solid var(--primary);
            background: rgba(44,95,124,0.08);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.3s ease;
        }
        .filter-btn-all .filter-count { font-size: 0.8rem; color: rgba(44,95,124,0.55); font-weight: 700; }
        .filter-btn-all.active { background: var(--primary); color: white; }
        .filter-btn-all.active .filter-count { color: rgba(255,255,255,0.75); }

        /* â”€â”€â”€ å¡ç‰‡ â”€â”€â”€ */
        .card-container { perspective: 1000px; margin-bottom: 1rem; }
        .flashcard {
            width: 100%; height: 500px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 2rem;
            background: var(--card);
        }
        .card-front { background: linear-gradient(135deg, #fff 0%, #f8f6f3 100%); }
        .card-back  { transform: rotateY(180deg); background: linear-gradient(135deg, #f8f6f3 0%, #fff 100%); }
        .card-image {
            max-width: 100%; max-height: 300px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            object-fit: contain;
        }
        .card-title {
            font-family: 'Crimson Pro', serif;
            font-size: 2rem; font-weight: 700;
            color: var(--primary); text-align: center; margin-bottom: 0.5rem;
        }
        .card-subtitle { font-size: 1.3rem; color: var(--secondary); text-align: center; font-weight: 500; }
        .card-info { width: 100%; text-align: left; overflow-y: auto; max-height: 200px; }
        .info-item { margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
        .info-item:last-child { border-bottom: none; }
        .info-label { font-weight: 700; color: var(--primary); margin-bottom: 0.3rem; font-size: 0.9rem; }
        .info-content { color: var(--text); line-height: 1.6; white-space: pre-line; font-size: 0.95rem; }
        .flip-hint {
            position: absolute; bottom: 1rem; left: 50%;
            transform: translateX(-50%);
            font-size: 0.85rem; color: #999;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%,100%{opacity:.5} 50%{opacity:1} }

        /* â”€â”€â”€ ç†Ÿæ‚‰æŒ‰éˆ• â”€â”€â”€ */
        .actions { display: flex; gap: 1rem; justify-content: center; margin-bottom: 0.9rem; }
        .action-btn {
            padding: 0.8rem 2rem; border: none; border-radius: 50px;
            font-weight: 600; font-size: 1rem; cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex: 1;
        }
        .btn-unfamiliar { background: var(--secondary); color: white; }
        .btn-unfamiliar:hover { background: #6d3d39; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(139,79,75,0.3); }
        .btn-familiar  { background: var(--success); color: white; }
        .btn-familiar:hover  { background: #45a049; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(76,175,80,0.3); }

        /* âœ… å­¸ç¿’æˆæ•ˆæŒ‰éˆ•ï¼šæ”¹æˆä¸€èˆ¬å€å¡Šï¼ˆä¸å›ºå®šï¼‰ */
        .stats-entry { display:flex; justify-content:center; margin-bottom: 1.4rem; }
        .stats-entry .stats-btn {
            width: 100%;
            max-width: 800px;
            padding: 0.85rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(44,95,124,0.25);
        }
        .stats-entry .stats-btn:hover { background: #1e4a5f; transform: translateY(-1px); }

        /* Powered by */
        .powered-by {
            margin-top: 1.6rem;
            font-size: 0.72rem;
            color: #bbb;
            letter-spacing: 0.5px;
        }

        /* â”€â”€â”€ Loading â”€â”€â”€ */
        .loading { text-align: center; padding: 3rem; font-size: 1.2rem; color: var(--primary); }
        .spinner {
            border: 4px solid var(--border); border-top: 4px solid var(--primary);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 0 auto 1rem;
        }
        @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }

        /* â”€â”€â”€ ç©ºé¡åˆ¥è¨Šæ¯ â”€â”€â”€ */
        .empty-msg {
            display: none; text-align: center;
            padding: 5rem 2rem;
            background: var(--card); border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .empty-msg .emoji { font-size: 3rem; margin-bottom: 1rem; }
        .empty-msg p { font-size: 1.2rem; color: var(--primary); font-weight: 600; }
        .empty-msg .sub { font-size: 0.9rem; color: #999; margin-top: 0.5rem; font-weight: 400; }

        /* â”€â”€â”€ å­¸ç¿’æˆæ•ˆé é¢ â”€â”€â”€ */
        .stats-page { display: none; }
        .stats-page-inner {
            background: var(--card); border-radius: 20px; padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .stats-header { margin-bottom: 1rem; }
        .nav-btn {
            padding: 0.6rem 1.5rem; background: var(--accent); color: white;
            border: none; border-radius: 25px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease;
        }
        .nav-btn:hover { background: #c9956a; transform: translateY(-2px); }

        .stats-title {
            font-family: 'Crimson Pro', serif; font-size: 2rem;
            color: var(--primary); margin-bottom: 1.5rem;
        }
        .stats-summary { display: grid; grid-template-columns: repeat(3,1fr); gap: 1rem; margin-bottom: 2rem; }
        .stats-card { color: white; padding: 1.5rem; border-radius: 15px; text-align: center; }
        .stats-card .num { font-size: 2.5rem; font-weight: 700; }
        .stats-card .label { font-size: 0.9rem; opacity: 0.9; }
        .stats-section { margin-bottom: 2.5rem; }
        .stats-section:last-child { margin-bottom: 0; }
        .stats-section h3 {
            font-family: 'Crimson Pro', serif; font-size: 1.5rem;
            margin-bottom: 1rem; padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }
        .stats-list-item {
            display: flex; align-items: center;
            padding: 0.9rem 1rem; background: white;
            border-radius: 10px; margin-bottom: 0.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .stats-list-item img {
            width: 75px; height: 75px; object-fit: cover;
            border-radius: 8px; margin-right: 1rem; flex-shrink: 0;
        }
        .stats-list-item .info { flex: 1; min-width: 0; }
        .stats-list-item .name-en { font-weight: 600; font-size: 1.05rem; color: var(--primary); }
        .stats-list-item .name-zh { color: var(--secondary); font-size: 0.9rem; }
        .stats-list-item .badge {
            color: white; padding: 0.4rem 0.9rem; border-radius: 20px;
            font-weight: 600; font-size: 0.85rem; white-space: nowrap; flex-shrink: 0;
        }
        .stats-empty { text-align: center; color: #999; padding: 1.5rem; }

        /* æ¸…ç©ºç´€éŒ„ */
        .clear-section { margin-top: 2.5rem; text-align: center; padding-top: 1.5rem; border-top: 1px solid var(--border); }
        .clear-btn {
            padding: 0.7rem 1.8rem;
            background: transparent;
            color: #999;
            border: 1.5px solid #ccc;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .clear-btn:hover { color: #c00; border-color: #c00; background: rgba(200,0,0,0.04); }

        /* â”€â”€â”€ æ»‘å‹•æ¨™è¨˜ï¼ˆå·¦å³å…©å´çš„ âŒ âœ…ï¼‰ â”€â”€â”€ */
        .swipe-label {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            font-weight: 800;
            opacity: 0;
            transition: opacity 0.15s ease;
            pointer-events: none;
            z-index: 2;
            user-select: none;
        }
        .swipe-label-left  { left: 1.2rem; color: var(--secondary); border: 3px solid var(--secondary); padding: 0.2rem 0.7rem; border-radius: 12px; font-size: 1.6rem; }
        .swipe-label-right { right: 1.2rem; color: var(--success);    border: 3px solid var(--success);    padding: 0.2rem 0.7rem; border-radius: 12px; font-size: 1.6rem; }

        /* é£›å‡ºå‹•ç•« */
        @keyframes flyLeft {
            0%   { transform: translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateX(-140%) rotate(-25deg); opacity: 0; }
        }
        @keyframes flyRight {
            0%   { transform: translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateX(140%) rotate(25deg); opacity: 0; }
        }
        .flashcard.fly-left  { animation: flyLeft 0.4s ease forwards; }
        .flashcard.fly-right { animation: flyRight 0.4s ease forwards; }

        /* â”€â”€â”€ æ­¡è¿é é¢ â”€â”€â”€ */
        .welcome-page {
            min-height: calc(100vh - 2rem);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem 1.5rem;
        }
        .welcome-card {
            background: var(--card);
            border-radius: 28px;
            padding: 3rem 2rem 2.5rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 540px;
            animation: welcomeFadeIn 0.6s ease forwards;
        }
        @keyframes welcomeFadeIn {
            0%   { opacity: 0; transform: translateY(24px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .welcome-icon {
            font-size: 3.2rem;
            margin-bottom: 0.3rem;
            animation: iconBounce 1.2s ease infinite alternate;
        }
        @keyframes iconBounce {
            0%   { transform: translateY(0); }
            100% { transform: translateY(-6px); }
        }
        .welcome-title {
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1.4rem;
            line-height: 1.5;
        }
        .welcome-title .heart { color: #e84c6a; font-size: 1.4rem; }
        .welcome-title-main {
            display: block;
            white-space: nowrap;
            font-size: clamp(1.1rem, 5.5vw, 1.7rem);
        }
        .welcome-title .sparkle { color: var(--accent); }
        .welcome-desc {
            font-size: 0.95rem;
            color: #6b6b6b;
            line-height: 1.8;
            margin-bottom: 2rem;
        }
        .welcome-desc .highlight {
            color: var(--primary);
            font-weight: 600;
        }
        .welcome-btn {
            display: inline-block;
            padding: 0.85rem 2.4rem;
            background: linear-gradient(135deg, var(--primary), #1e4a5f);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(44,95,124,0.35);
        }
        .welcome-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(44,95,124,0.45); }
        .welcome-btn:active { transform: translateY(0); }

        /* â”€â”€â”€ æ‰‹æ©Ÿç‰ˆ â”€â”€â”€ */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .flashcard { height: 450px; }
            .card-title { font-size: 1.8rem; }
            .card-subtitle { font-size: 1.2rem; }

            /* âœ… æ›´å£“ç¸®é¦–å±ï¼šcontrols æ›´è–„ */
            .controls { padding: 0.65rem 0.8rem; margin-bottom: 0.7rem; }
            .filter-sub-group { gap: 0.4rem; }
            .filter-btn { padding: 0.4rem 0.25rem; }
            .filter-btn-all { padding: 0.5rem 0.9rem; font-size: 0.92rem; }

            /* æŒ‰éˆ•ä¸¦æ’ */
            .actions { flex-direction: row; gap: 0.7rem; }
            .action-btn { padding: 0.8rem 0.5rem; font-size: 0.95rem; }

            /* å­¸ç¿’æˆæ•ˆ ç¸½è¦½ç¸®å° */
            .stats-summary { gap: 0.6rem; }
            .stats-card { padding: 0.9rem 0.5rem; border-radius: 12px; }
            .stats-card .num { font-size: 1.8rem; }
            .stats-card .label { font-size: 0.75rem; }
            .stats-title { font-size: 1.5rem; margin-bottom: 1rem; }
            .stats-section h3 { font-size: 1.1rem; }

            /* å­¸ç¿’æˆæ•ˆ æ¸…å–® */
            .stats-list-item { padding: 0.7rem 0.6rem; flex-wrap: wrap; gap: 0.5rem; }
            .stats-list-item img { width: 60px; height: 60px; margin-right: 0.7rem; }
            .stats-list-item .name-en { font-size: 0.88rem; }
            .stats-list-item .name-zh { font-size: 0.78rem; }
            .stats-list-item .badge { font-size: 0.72rem; padding: 0.3rem 0.7rem; }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- æ­¡è¿é é¢ -->
    <div id="welcomePage" class="welcome-page">
        <div class="welcome-card">
            <div class="welcome-icon">ğŸ’ª</div>
            <div class="welcome-title">
                <span class="heart">â¤ï¸</span> ä½ å¥½~<br>
                <span class="welcome-title-main">é€™è£¡æ˜¯è‚Œè‚‰è§£å‰–å­¸çš„<span class="sparkle">è¤‡ç¿’å°å¤©å ‚</span>ğŸ’«</span>
            </div>
            <p class="welcome-desc">
                å¸Œæœ›ä½ å¯ä»¥ä»¥<span class="highlight">è¼•é¬†äº¤å‹</span>çš„æ–¹å¼<br>
                å¿«é€Ÿè¤‡ç¿’è§£å‰–å­¸çš„ç›¸é—œçŸ¥è­˜<br><br>
                å¿«ä¾†è©¦è©¦ä¾†å°‹æ‰¾ä½ çš„<span class="highlight">è‚Œå‘½å¤©å­</span>å§ï½
            </p>
            <button class="welcome-btn" id="btnStart">é–‹å§‹è¤‡ç¿’ â€º</button>
            <p class="powered-by">Powered by Luga</p>
        </div>
    </div>

    <!-- æ¨™é¡Œ -->
    <div class="header">
        <h1>Musculature Heaven</h1>
        <p class="subtitle">è‚Œè‚‰è§£å‰–å­¸è¤‡ç¿’å°å¤©å ‚</p>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading" style="display:none;">
        <div class="spinner"></div>
        <p>è¼‰å…¥è³‡æ–™ä¸­...</p>
    </div>

    <!-- ç©ºé¡åˆ¥è¨Šæ¯ -->
    <div id="emptyMsg" class="empty-msg">
        <div class="emoji">ğŸ“­</div>
        <p>ä½ é‚„æ²’æœ‰ç´€éŒ„å–”</p>
        <p class="sub">3 ç§’å¾Œè‡ªå‹•å›åˆ°å…¨éƒ¨...</p>
    </div>

    <!-- ä¸»é é¢ -->
    <div id="app" style="display:none;">
        <!-- âœ… ç¯©é¸å™¨ï¼šå­é¡åˆ¥åœ¨ä¸Šã€å…¨éƒ¨åœ¨ä¸‹ -->
        <div class="controls">
            <div class="filter-buttons">
                <div class="filter-sub-group">
                    <button class="filter-btn" data-filter="unfamiliar">
                        <span class="filter-label">âŒ é‚„ä¸ç†Ÿ</span>
                        <span class="filter-count" id="countUnfamiliar">0</span>
                    </button>
                    <button class="filter-btn" data-filter="familiar">
                        <span class="filter-label">âœ… ç†Ÿæ‚‰äº†</span>
                        <span class="filter-count" id="countFamiliar">0</span>
                    </button>
                    <button class="filter-btn" data-filter="unseen">
                        <span class="filter-label">ğŸ‘€ é‚„æ²’çœ‹</span>
                        <span class="filter-count" id="countUnseen">0</span>
                    </button>
                </div>

                <button class="filter-btn-all active" data-filter="all">
                    <span>å…¨éƒ¨</span>
                    <span class="filter-count" id="countAll">0</span>
                </button>
            </div>
        </div>

        <!-- å¡ç‰‡ -->
        <div class="card-container">
            <div class="flashcard" id="flashcard">
                <!-- æ»‘å‹•æ¨™è¨˜ -->
                <div class="swipe-label swipe-label-left"  id="swipeLeft">âŒ é‚„ä¸ç†Ÿ</div>
                <div class="swipe-label swipe-label-right" id="swipeRight">âœ… ç†Ÿæ‚‰äº†</div>
                <div class="card-face card-front">
                    <img id="cardImage" class="card-image" alt="Muscle" style="max-height:90%;margin:0;">
                    <div class="flip-hint">ğŸ‘† é»æ“Šç¿»è½‰æŸ¥çœ‹è³‡è¨Š</div>
                </div>
                <div class="card-face card-back">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;width:100%;margin-bottom:1.5rem;">
                        <div style="display:flex;align-items:center;justify-content:center;">
                            <img id="cardImageBack" class="card-image" alt="Muscle" style="max-height:200px;margin:0;">
                        </div>
                        <div style="display:flex;flex-direction:column;justify-content:center;">
                            <h2 class="card-title" id="cardTitleEN">Muscle Name</h2>
                            <p class="card-subtitle" id="cardTitleZH">è‚Œè‚‰åç¨±</p>
                        </div>
                    </div>
                    <div class="card-info" id="cardInfo"></div>
                    <div class="flip-hint">ğŸ‘† é»æ“Šç¿»å›æ­£é¢</div>
                </div>
            </div>
        </div>

        <!-- ç†Ÿæ‚‰æŒ‰éˆ• -->
        <div class="actions">
            <button class="action-btn btn-unfamiliar" id="btnUnfamiliar">âŒ é‚„ä¸ç†Ÿ</button>
            <button class="action-btn btn-familiar"   id="btnFamiliar">âœ… ç†Ÿæ‚‰äº†</button>
        </div>

        <!-- âœ… æˆ‘çš„å­¸ç¿’æˆæ•ˆï¼šä¸å›ºå®šåº•éƒ¨ï¼Œæ”¾åœ¨é€™è£¡ -->
        <div class="stats-entry">
            <button class="stats-btn" id="btnStats">ğŸ“Š æˆ‘çš„å­¸ç¿’æˆæ•ˆ</button>
        </div>
    </div>

    <!-- å­¸ç¿’æˆæ•ˆé é¢ -->
    <div id="statsPage" class="stats-page">
        <div class="stats-page-inner">
            <div class="stats-header">
                <button class="nav-btn" id="btnBackToMain" style="background:var(--accent);">â† è¿”å›ä¸»é </button>
            </div>
            <h2 class="stats-title">ğŸ“Š æˆ‘çš„å­¸ç¿’æˆæ•ˆ</h2>
            <div class="stats-summary">
                <div class="stats-card" style="background:linear-gradient(135deg,var(--primary),#1e4a5f);">
                    <div class="num" id="statsTotal">0</div><div class="label">ç¸½é¡Œæ•¸</div>
                </div>
                <div class="stats-card" style="background:linear-gradient(135deg,var(--success),#45a049);">
                    <div class="num" id="statsFamiliar">0</div><div class="label">å·²ç†Ÿæ‚‰</div>
                </div>
                <div class="stats-card" style="background:linear-gradient(135deg,var(--secondary),#6d3d39);">
                    <div class="num" id="statsUnfamiliar">0</div><div class="label">é‚„ä¸ç†Ÿ</div>
                </div>
            </div>
            <div class="stats-section">
                <h3 style="color:var(--secondary);">âŒ æˆ‘æœ€å¸¸éŒ¯çš„ï¼ˆå‰ 10 åï¼‰</h3>
                <div id="mostWrongList"></div>
            </div>
            <div class="stats-section">
                <h3 style="color:var(--success);">âœ… æˆ‘æœ€ç†Ÿçš„ï¼ˆå‰ 10 åï¼‰</h3>
                <div id="mostCorrectList"></div>
            </div>

            <div class="clear-section">
                <button class="clear-btn" id="btnClear">ğŸ—‘ï¸ æ¸…ç©ºç´€éŒ„</button>
            </div>
        </div>
    </div>

</div><!-- /container -->

<script>
// â”€â”€â”€ å¸¸æ•¸ â”€â”€â”€
const GITHUB_USER = 'ougaga26-lab';
const REPO_NAME   = 'Musculature-Heaven';
const RAW_BASE    = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/`;
const CSV_PATH    = 'data/muscles.csv';
const IMG_PATH    = 'images/';

// â”€â”€â”€ ç‹€æ…‹ â”€â”€â”€
let allCards      = [];
let cardQueue     = [];
let currentIndex  = 0;
let currentFilter = 'all';
let familiarityData = {};   // { filename: 'unseen' | 'unfamiliar' | 'familiar' }
let statsData       = {};   // { filename: { wrong, correct, nameEN, nameZH, image } }

// â”€â”€â”€ é é¢åˆ‡æ› helper â”€â”€â”€
function showPage(name) {
    const welcome = document.getElementById('welcomePage');
    const loading = document.getElementById('loading');
    const app     = document.getElementById('app');
    const stats   = document.getElementById('statsPage');

    welcome.style.display = 'none';
    loading.style.display = 'none';
    app.style.display     = 'none';
    stats.style.display   = 'none';

    if (name === 'welcome') { welcome.style.display = 'block'; }
    else if (name === 'loading') { loading.style.display = 'block'; }
    else if (name === 'app')     { app.style.display = 'block'; }
    else if (name === 'stats')   { stats.style.display = 'block'; }
}

// â”€â”€â”€ localStorage â”€â”€â”€
function loadSaved() {
    try { familiarityData = JSON.parse(localStorage.getItem('musculature_familiarity')) || {}; } catch(e){}
    try { statsData       = JSON.parse(localStorage.getItem('musculature_stats'))       || {}; } catch(e){}
}
function saveSaved() {
    localStorage.setItem('musculature_familiarity', JSON.stringify(familiarityData));
    localStorage.setItem('musculature_stats',       JSON.stringify(statsData));
}

// â”€â”€â”€ CSV è§£æ â”€â”€â”€
function parseCSV(text) {
    text = text.replace(/\r\n/g,'\n').replace(/\r/g,'\n');
    const lines   = text.split('\n');
    const headers = parseCSVLine(lines[0]);
    const data    = [];
    let i = 1;
    while (i < lines.length) {
        if (!lines[i].trim()) { i++; continue; }
        let row = lines[i];
        let qc  = (row.match(/"/g)||[]).length;
        while (qc % 2 !== 0 && i+1 < lines.length) { i++; row += '\n'+lines[i]; qc = (row.match(/"/g)||[]).length; }
        const vals = parseCSVLine(row);
        if (vals.length === headers.length) {
            const obj = {};
            headers.forEach((h,idx) => obj[h] = vals[idx]);
            data.push(obj);
        }
        i++;
    }
    return data;
}
function parseCSVLine(line) {
    const vals = []; let cur = '', inQ = false;
    for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch==='"') { if (inQ && line[i+1]==='"') { cur+='"'; i++; } else inQ=!inQ; }
        else if (ch===',' && !inQ) { vals.push(cur.trim()); cur=''; }
        else cur += ch;
    }
    vals.push(cur.trim());
    return vals;
}

// â”€â”€â”€ è¼‰å…¥ â”€â”€â”€
async function loadData() {
    try {
        const res  = await fetch(RAW_BASE + CSV_PATH);
        const text = await res.text();
        allCards   = parseCSV(text);

        // æ–°å¡ç‰‡é è¨­ unseen
        allCards.forEach(c => { if (!familiarityData[c['picture file']]) familiarityData[c['picture file']] = 'unseen'; });

        applyFilter();
        updateProgress();
        showCard(0);

        document.getElementById('loading').style.display = 'none';
        showPage('app');
    } catch(err) {
        document.getElementById('loading').innerHTML = `<p style="color:#c00;">è¼‰å…¥å¤±æ•—ï¼</p><p style="font-size:.9rem;margin-top:.5rem;">${err.message}</p>`;
    }
}

// â”€â”€â”€ ç¯©é¸ â”€â”€â”€
function applyFilter() {
    const filtered = currentFilter === 'all'
        ? [...allCards]
        : allCards.filter(c => familiarityData[c['picture file']] === currentFilter);
    cardQueue    = shuffleArray(filtered);
    currentIndex = 0;
}
function shuffleArray(arr) {
    const a = [...arr];
    for (let i = a.length-1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
    return a;
}

// è¤‡ç¿’æ’å…¥ï¼ˆæ¯ 7 å¼µå¾Œå†å‡ºç¾ï¼‰â€” åªåœ¨ã€Œå…¨éƒ¨ã€æ¨¡å¼è§¸ç™¼
function insertReviewCard(card) {
    cardQueue.splice(Math.min(currentIndex+7, cardQueue.length), 0, card);
}

// â”€â”€â”€ é¡¯ç¤ºå¡ç‰‡ â”€â”€â”€
const FALLBACK_IMG = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="300" height="200" fill="%23ddd"/><text x="150" y="100" text-anchor="middle" fill="%23999" font-size="16">åœ–ç‰‡è¼‰å…¥å¤±æ•—</text></svg>';

function showCard(idx) {
    if (!cardQueue.length) return;
    const card = cardQueue[idx];
    const url  = RAW_BASE + IMG_PATH + card['picture file'];

    ['cardImage','cardImageBack'].forEach(id => {
        const el = document.getElementById(id);
        el.src = url;
        el.onerror = function(){ this.src = FALLBACK_IMG; };
    });

    document.getElementById('cardTitleEN').textContent = card['name (EN)'] || '';
    document.getElementById('cardTitleZH').textContent = card['name (CN)'] || '';

    document.getElementById('cardInfo').innerHTML = [
        ['Origin / èµ·å§‹é»',    card['Origin'],    card['èµ·å§‹é»']],
        ['Insertion / çµæŸé»', card['Insertion'], card['çµæŸé»']],
        ['Action / å‹•ä½œ',      card['Action'],    card['å‹•ä½œ']],
        ['Nerve / ç¥ç¶“æ”¯é…',   card['Nerve'],     card['ç¥ç¶“æ”¯é…']]
    ].map(([label,en,zh]) =>
        `<div class="info-item"><div class="info-label">${label}</div><div class="info-content">${en||''}\n${zh||''}</div></div>`
    ).join('');

    document.getElementById('flashcard').classList.remove('flipped');
    document.getElementById('flashcard').style.transform  = '';
    document.getElementById('flashcard').style.transition = '';

    const isFam = familiarityData[card['picture file']] === 'familiar';
    document.getElementById('btnFamiliar').style.opacity   = isFam ? '1' : '0.5';
    document.getElementById('btnUnfamiliar').style.opacity = isFam ? '0.5' : '1';
}

// â”€â”€â”€ æ›´æ–°ç¯©é¸å™¨æ•¸å­— â”€â”€â”€
function updateProgress() {
    const total = allCards.length;
    const fam   = allCards.filter(c => familiarityData[c['picture file']] === 'familiar').length;
    const unfam = allCards.filter(c => familiarityData[c['picture file']] === 'unfamiliar').length;
    document.getElementById('countAll').textContent        = total;
    document.getElementById('countFamiliar').textContent   = fam;
    document.getElementById('countUnfamiliar').textContent = unfam;
    document.getElementById('countUnseen').textContent     = total - fam - unfam;
}

// â”€â”€â”€ å­¸ç¿’æˆæ•ˆé é¢ â”€â”€â”€
function showStatsPage() {
    showPage('stats');

    document.getElementById('statsTotal').textContent      = allCards.length;
    document.getElementById('statsFamiliar').textContent   = allCards.filter(c => familiarityData[c['picture file']]==='familiar').length;
    document.getElementById('statsUnfamiliar').textContent = allCards.filter(c => familiarityData[c['picture file']]==='unfamiliar').length;

    const renderList = (id, key, label, bg) => {
        const list = Object.values(statsData).filter(s=>s[key]>0).sort((a,b)=>b[key]-a[key]).slice(0,10);
        document.getElementById(id).innerHTML = list.length
            ? list.map(item => `
                <div class="stats-list-item">
                    <img src="${RAW_BASE}${IMG_PATH}${item.image}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2275%22 height=%2275%22><rect width=%2275%22 height=%2275%22 fill=%22%23ddd%22/></svg>'">
                    <div class="info"><div class="name-en">${item.nameEN}</div><div class="name-zh">${item.nameZH}</div></div>
                    <div class="badge" style="background:${bg};">${label} ${item[key]} æ¬¡</div>
                </div>`).join('')
            : '<p class="stats-empty">é‚„æ²’æœ‰ç´€éŒ„</p>';
    };
    renderList('mostWrongList',   'wrong',   'éŒ¯èª¤', 'var(--secondary)');
    renderList('mostCorrectList', 'correct', 'æ­£ç¢º', 'var(--success)');
}

// â”€â”€â”€ äº‹ä»¶ç›£è½ â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
    loadSaved();

    // é€²ä¾†å…ˆé¡¯ç¤ºæ­¡è¿é 
    document.getElementById('btnStart').addEventListener('click', () => {
        if (allCards.length === 0) {
            showPage('loading');
            loadData();
        } else {
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn-all, .filter-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-filter="all"]').classList.add('active');
            applyFilter();
            showCard(0);
            showPage('app');
        }
    });

    // ç¿»ç‰Œ click
    document.getElementById('flashcard').addEventListener('click', e => {
        if (window._swipeEndedAsDrag) { window._swipeEndedAsDrag = false; return; }
        if (!e.target.classList.contains('action-btn'))
            document.getElementById('flashcard').classList.toggle('flipped');
    });

    // ç¯©é¸å™¨
    const allBtns = document.querySelectorAll('.filter-btn-all, .filter-btn');
    allBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const f = btn.dataset.filter;

            // å­é¡åˆ¥ç‚ºç©º â†’ è¨Šæ¯ + 3ç§’å°å›
            if (f !== 'all') {
                const cnt = allCards.filter(c => familiarityData[c['picture file']] === f).length;
                if (cnt === 0) {
                    document.getElementById('app').style.display = 'none';
                    document.getElementById('emptyMsg').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('emptyMsg').style.display = 'none';
                        allBtns.forEach(b => b.classList.remove('active'));
                        document.querySelector('[data-filter="all"]').classList.add('active');
                        currentFilter = 'all';
                        applyFilter();
                        showCard(0);
                        showPage('app');
                    }, 3000);
                    return;
                }
            }

            allBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = f;
            applyFilter();
            showCard(0);
        });
    });

    // âŒ é‚„ä¸ç†Ÿ
    document.getElementById('btnUnfamiliar').addEventListener('click', () => {
        const card = cardQueue[currentIndex], fn = card['picture file'];
        familiarityData[fn] = 'unfamiliar';
        if (!statsData[fn]) statsData[fn] = { wrong:0, correct:0, nameEN: card['name (EN)'], nameZH: card['name (CN)'], image: fn };
        statsData[fn].wrong++;
        saveSaved(); updateProgress();

        if (currentFilter === 'all') insertReviewCard(card);

        if (currentIndex < cardQueue.length-1) { currentIndex++; showCard(currentIndex); }
        else showCard(currentIndex);
    });

    // âœ… ç†Ÿæ‚‰äº†
    document.getElementById('btnFamiliar').addEventListener('click', () => {
        const card = cardQueue[currentIndex], fn = card['picture file'];
        familiarityData[fn] = 'familiar';
        if (!statsData[fn]) statsData[fn] = { wrong:0, correct:0, nameEN: card['name (EN)'], nameZH: card['name (CN)'], image: fn };
        statsData[fn].correct++;
        saveSaved(); updateProgress();

        if (currentIndex < cardQueue.length-1) { currentIndex++; showCard(currentIndex); }
        else showCard(currentIndex);
    });

    // å­¸ç¿’æˆæ•ˆ
    document.getElementById('btnStats').addEventListener('click', showStatsPage);
    document.getElementById('btnBackToMain').addEventListener('click', () => showPage('app'));

    // æ¸…ç©ºç´€éŒ„
    document.getElementById('btnClear').addEventListener('click', () => {
        if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ\né€™æœƒæŠŠç†Ÿæ‚‰åº¦å’Œå­¸ç¿’çµ±è¨ˆå…¨éƒ¨åˆªæ‰ï¼Œå¾é ­ä¾†éã€‚')) return;
        familiarityData = {};
        statsData       = {};
        localStorage.removeItem('musculature_familiarity');
        localStorage.removeItem('musculature_stats');
        allCards.forEach(c => { familiarityData[c['picture file']] = 'unseen'; });
        saveSaved();
        updateProgress();
        showPage('welcome');
    });

    // â”€â”€â”€ è§¸æ‘¸æ»‘å‹• â”€â”€â”€
    (function initSwipe() {
        const card      = document.getElementById('flashcard');
        const labelL    = document.getElementById('swipeLeft');
        const labelR    = document.getElementById('swipeRight');
        const THRESHOLD = 80;
        const DRAG_MIN  = 12;

        let startX = 0, startY = 0, curX = 0;
        let state = 'idle';
        window._swipeEndedAsDrag = false;

        function onStart(x, y) {
            if (card.classList.contains('fly-left') || card.classList.contains('fly-right')) return;
            startX = x; startY = y; curX = 0;
            state = 'deciding';
            window._swipeEndedAsDrag = false;
        }

        function onMove(x, y) {
            if (state === 'idle' || state === 'cancelled') return;

            const dx = x - startX;
            const dy = y - startY;

            if (state === 'deciding') {
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < DRAG_MIN) return;

                if (Math.abs(dy) >= Math.abs(dx)) { state = 'cancelled'; return; }
                state = 'dragging-h';
                card.style.transition = 'none';
            }

            curX = dx;
            const rot = Math.max(-18, Math.min(18, dx * 0.04));
            card.style.transform = card.classList.contains('flipped')
                ? `rotateY(180deg) translateX(${-dx}px) rotate(${-rot}deg)`
                : `translateX(${dx}px) rotate(${rot}deg)`;

            const prog = Math.min(Math.abs(dx) / THRESHOLD, 1);
            labelL.style.opacity = dx < 0 ? prog : 0;
            labelR.style.opacity = dx > 0 ? prog : 0;
        }

        function onEnd() {
            if (state === 'idle' || state === 'cancelled') { state = 'idle'; return; }
            if (state === 'deciding') { state = 'idle'; return; }

            state = 'idle';
            window._swipeEndedAsDrag = true;
            labelL.style.opacity = 0;
            labelR.style.opacity = 0;

            if (curX < -THRESHOLD) {
                card.style.transition = '';
                card.classList.add('fly-left');
                card.addEventListener('animationend', () => {
                    card.classList.remove('fly-left');
                    card.style.transform = '';
                    document.getElementById('btnUnfamiliar').click();
                }, { once: true });
            } else if (curX > THRESHOLD) {
                card.style.transition = '';
                card.classList.add('fly-right');
                card.addEventListener('animationend', () => {
                    card.classList.remove('fly-right');
                    card.style.transform = '';
                    document.getElementById('btnFamiliar').click();
                }, { once: true });
            } else {
                card.style.transition = 'transform 0.35s cubic-bezier(.25,.8,.25,1)';
                card.style.transform  = card.classList.contains('flipped') ? 'rotateY(180deg)' : '';
            }
        }

        card.addEventListener('touchstart', e => onStart(e.touches[0].clientX, e.touches[0].clientY), { passive: true });

        card.addEventListener('touchmove', e => {
            if (state === 'dragging-h') e.preventDefault();
            onMove(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        card.addEventListener('touchend', () => onEnd());

        // mouse
        let mouseDragging = false;
        card.addEventListener('mousedown', e => { if (e.button !== 0) return; mouseDragging = true; onStart(e.clientX, e.clientY); });
        window.addEventListener('mousemove', e => { if (!mouseDragging) return; onMove(e.clientX, e.clientY); });
        window.addEventListener('mouseup', () => { if (mouseDragging) { mouseDragging = false; onEnd(); } });
    })();

    // éµç›¤å¿«æ·
    document.addEventListener('keydown', e => {
        if (e.key==='ArrowLeft')  { e.preventDefault(); document.getElementById('btnUnfamiliar').click(); }
        else if (e.key==='ArrowRight') { e.preventDefault(); document.getElementById('btnFamiliar').click(); }
        else if (e.key===' ') { e.preventDefault(); document.getElementById('flashcard').classList.toggle('flipped'); }
    });
});
</script>
</body>
</html>
