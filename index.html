<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Musculature Heaven</title>
  <!-- Open Graph / Social Preview -->
<meta property="og:type" content="website">
<meta property="og:title" content="Musculature Heavenï½œè‚Œè‚‰è§£å‰–å­¸è¤‡ç¿’å°å¤©å ‚">
<meta property="og:description" content="ä»¥è¼•é¬†äº¤å‹çš„æ–¹å¼ï¼Œå¿«é€Ÿè¤‡ç¿’è§£å‰–å­¸çš„ç›¸é—œçŸ¥è­˜ï¼Œè®“è§£å‰–å­¸ä¸å†ç—›è‹¦ã€‚">
<meta property="og:url" content="https://ougaga26-lab.github.io/Musculature-Heaven/">
<meta property="og:image" content="https://ougaga26-lab.github.io/Musculature-Heaven/og-preview.png">

<!-- LINE / Facebook / Twitter fallback -->
<meta name="twitter:card" content="summary_large_image">
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;}

    :root{
      --primary:#2c5f7c;
      --secondary:#8b4f4b;
      --accent:#d4a373;
      --success:#4caf50;
      --card:#fff;
      --text:#2a2a2a;
      --border:#d4cfc4;
    }

    body{
      font-family:'Noto Sans TC',sans-serif;
      background:linear-gradient(135deg,#f8f6f3 0%, #ebe8e1 100%);
      color:var(--text);
      min-height:100vh;
      padding:1rem;
    }

    .container{max-width:800px;margin:0 auto;}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header{text-align:center;margin-bottom:.6rem;}
    h1{
      font-family:'Crimson Pro',serif;
      font-size:2.2rem;
      font-weight:700;
      color:var(--primary);
      margin-bottom:0;
    }

    .stats-entry-top{
      display:none;
      justify-content:center;
      margin:.55rem 0 1rem;
    }
    .stats-entry-top .stats-btn{
      width:100%;
      max-width:800px;
      padding:.85rem 1rem;
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:14px;
      font-weight:600;
      font-size:1rem;
      cursor:pointer;
      transition:all .25s ease;
      box-shadow:0 4px 16px rgba(44,95,124,.25);
    }
    .stats-entry-top .stats-btn:hover{background:#1e4a5f;transform:translateY(-1px);}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Controls / Filters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls{
      background:var(--card);
      border-radius:14px;
      padding:.65rem .8rem;
      margin:.4rem 0 .9rem;
      box-shadow:0 5px 20px rgba(0,0,0,.08);
    }
    .filter-buttons{
      display:flex;
      flex-direction:column;
      gap:.55rem;
      width:100%;
    }
    .filter-sub-group{display:flex;gap:.45rem;width:100%;}

    .filter-btn{
      flex:1;
      padding:.42rem .25rem;
      font-size:.78rem;
      border:1.5px solid var(--border);
      border-radius:10px;
      background:#fff;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:.12rem;
      min-width:0;
      transition:all .2s ease;
    }
    .filter-label{white-space:nowrap;}
    .filter-count{font-size:.68rem;color:#999;font-weight:600}
    .filter-btn.active{
      background:var(--primary);
      color:#fff;
      border-color:var(--primary);
    }
    .filter-btn.active .filter-count{color:rgba(255,255,255,.7);}

    .filter-btn-all{
      width:100%;
      padding:.55rem 1rem;
      font-size:.95rem;
      border:2px solid var(--primary);
      background:rgba(44,95,124,.08);
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.4rem;
      transition:all .2s ease;
    }
    .filter-btn-all .filter-count{font-size:.8rem;color:rgba(44,95,124,.55);font-weight:700;}
    .filter-btn-all.active{background:var(--primary);color:#fff;}
    .filter-btn-all.active .filter-count{color:rgba(255,255,255,.75);}

    /* æ”¶è—å…¥å£æŒ‰éˆ•ï¼ˆå…¨éƒ¨ä¸‹é¢ï¼‰ */
    .fav-entry-btn{
      width:100%;
      padding:.52rem 1rem;
      font-size:.88rem;
      border:1.5px solid var(--accent);
      background:rgba(212,163,115,.08);
      border-radius:11px;
      font-weight:600;
      color:var(--accent);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.35rem;
      transition:all .2s ease;
      margin-top:.1rem;
    }
    .fav-entry-btn:hover{background:rgba(212,163,115,.18);}
    .fav-entry-btn .fav-count{font-size:.75rem;color:var(--accent);opacity:.7;font-weight:600;}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card-container{perspective:1000px;margin-bottom:.85rem;position:relative;}

    .flashcard{
      width:100%;
      height:380px;
      position:relative;
      transform-style:preserve-3d;
      transition:transform .6s;
      cursor:pointer;
    }
    .flashcard.flipped{transform:rotateY(180deg);}

    .card-face{
      position:absolute;
      width:100%;
      height:100%;
      backface-visibility:hidden;
      border-radius:18px;
      box-shadow:0 10px 40px rgba(0,0,0,.15);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:1.2rem;
      background:var(--card);
    }
    .card-front{background:linear-gradient(135deg,#fff 0%, #f8f6f3 100%);}
    .card-back{
      transform:rotateY(180deg);
      background:linear-gradient(135deg,#f8f6f3 0%, #fff 100%);
      justify-content:flex-start;
    }

    .card-image{
      max-width:100%;
      max-height:300px;
      border-radius:12px;
      box-shadow:0 5px 20px rgba(0,0,0,.1);
      object-fit:contain;
    }

    .card-title{
      font-family:'Crimson Pro',serif;
      font-size:1.9rem;
      font-weight:700;
      color:var(--primary);
      text-align:center;
      margin-bottom:.35rem;
    }
    .card-subtitle{
      font-size:1.2rem;
      color:var(--secondary);
      text-align:center;
      font-weight:500;
    }

    .card-info{
      width:100%;
      text-align:left;
      overflow-y:auto;
      max-height:240px;
      margin-top:.2rem;
    }
    .info-item{margin-bottom:1.1rem;padding-bottom:.85rem;border-bottom:1px solid var(--border);}
    .info-item:last-child{border-bottom:none;margin-bottom:.2rem;padding-bottom:0;}
    .info-label{font-weight:700;color:var(--primary);margin-bottom:.25rem;font-size:.9rem;}
    .info-content{color:var(--text);line-height:1.6;white-space:pre-line;font-size:.95rem;}

    .flip-hint{
      position:absolute;
      bottom:.8rem;
      left:50%;
      transform:translateX(-50%);
      font-size:.82rem;
      color:#999;
      animation:pulse 2s infinite;
    }
    @keyframes pulse{0%,100%{opacity:.55} 50%{opacity:1}}

    /* â”€â”€ æ”¶è— iconï¼ˆå¡ç‰‡å·¦ä¸Šè§’ï¼‰ */
    .fav-icon-btn{
      position:absolute;
      top:.55rem;
      left:.55rem;
      z-index:10;
      background:rgba(255,255,255,.85);
      border:none;
      border-radius:50%;
      width:2.1rem;
      height:2.1rem;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:1.2rem;
      box-shadow:0 2px 8px rgba(0,0,0,.18);
      transition:transform .2s ease, background .2s ease;
      -webkit-tap-highlight-color:transparent;
    }
    .fav-icon-btn:hover{transform:scale(1.12);}
    .fav-icon-btn.is-fav{background:rgba(255,80,100,.9);}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .actions{display:flex;gap:.75rem;margin-bottom:.7rem;}
    .action-btn{
      flex:1;
      padding:.8rem .4rem;
      border:none;
      border-radius:50px;
      font-weight:600;
      font-size:.98rem;
      cursor:pointer;
      transition:all .2s ease;
      box-shadow:0 5px 15px rgba(0,0,0,.1);
    }
    .btn-unfamiliar{background:var(--secondary);color:#fff}
    .btn-familiar{background:var(--success);color:#fff}
    .btn-unfamiliar:hover{background:#6d3d39;transform:translateY(-1px)}
    .btn-familiar:hover{background:#45a049;transform:translateY(-1px)}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Empty / Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .loading{text-align:center;padding:3rem;color:var(--primary);}
    .spinner{
      border:4px solid var(--border);
      border-top:4px solid var(--primary);
      border-radius:50%;
      width:40px;height:40px;
      animation:spin 1s linear infinite;
      margin:0 auto 1rem;
    }
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    .empty-msg{
      display:none;
      text-align:center;
      padding:4.5rem 2rem;
      background:var(--card);
      border-radius:20px;
      box-shadow:0 10px 40px rgba(0,0,0,.08);
    }
    .empty-msg .emoji{font-size:3rem;margin-bottom:1rem}
    .empty-msg p{font-size:1.15rem;color:var(--primary);font-weight:600}
    .empty-msg .sub{font-size:.9rem;color:#999;margin-top:.5rem;font-weight:400}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Stats Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-page{display:none;}
    .stats-page-inner{
      background:var(--card);
      border-radius:20px;
      padding:2rem;
      box-shadow:0 10px 40px rgba(0,0,0,.08);
    }
    .stats-header{margin-bottom:1rem}
    .nav-btn{
      padding:.6rem 1.5rem;
      border:none;
      border-radius:25px;
      background:var(--accent);
      color:#fff;
      font-weight:600;
      cursor:pointer;
      transition:all .2s ease;
    }
    .nav-btn:hover{background:#c9956a;transform:translateY(-1px)}
    .stats-title{
      font-family:'Crimson Pro',serif;
      font-size:2rem;
      color:var(--primary);
      margin-bottom:1.5rem;
    }
    .stats-summary{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem;}
    .stats-card{color:#fff;padding:1.2rem;border-radius:15px;text-align:center;}
    .stats-card .num{font-size:2.2rem;font-weight:700}
    .stats-card .label{font-size:.9rem;opacity:.9}

    .stats-section{margin-bottom:2.2rem}
    .stats-section:last-child{margin-bottom:0}
    .stats-section h3{
      font-family:'Crimson Pro',serif;
      font-size:1.35rem;
      margin-bottom:1rem;
      padding-bottom:.5rem;
      border-bottom:2px solid var(--border);
    }

    .stats-list-item{
      display:flex;
      align-items:center;
      padding:.85rem 1rem;
      background:#fff;
      border-radius:10px;
      margin-bottom:.5rem;
      box-shadow:0 2px 10px rgba(0,0,0,.05);
      cursor:pointer;
      transition:background .15s;
    }
    .stats-list-item:hover{background:#f5f3f0;}
    .stats-list-item img{
      width:72px;height:72px;
      object-fit:cover;
      border-radius:8px;
      margin-right:1rem;
      flex-shrink:0;
    }
    .stats-list-item .info{flex:1;min-width:0;}
    .stats-list-item .name-en{font-weight:600;font-size:1.02rem;color:var(--primary)}
    .stats-list-item .name-zh{color:var(--secondary);font-size:.9rem}
    .stats-list-item .badge{
      color:#fff;
      padding:.38rem .85rem;
      border-radius:20px;
      font-weight:600;
      font-size:.85rem;
      white-space:nowrap;
      flex-shrink:0;
    }
    .stats-empty{text-align:center;color:#999;padding:1.2rem}

    .clear-section{margin-top:2.2rem;text-align:center;padding-top:1.4rem;border-top:1px solid var(--border);}
    .clear-btn{
      padding:.7rem 1.8rem;
      background:transparent;
      color:#999;
      border:1.5px solid #ccc;
      border-radius:25px;
      font-size:.9rem;
      font-weight:500;
      cursor:pointer;
      transition:all .2s ease;
    }
    .clear-btn:hover{color:#c00;border-color:#c00;background:rgba(200,0,0,.04)}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Favorites Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fav-page{display:none;}
    .fav-page-inner{
      background:var(--card);
      border-radius:20px;
      padding:2rem;
      box-shadow:0 10px 40px rgba(0,0,0,.08);
    }
    .fav-page-inner .stats-header{margin-bottom:1rem;}
    .fav-page-inner .stats-title{font-size:1.7rem;margin-bottom:1.2rem;}
    .fav-list-empty{text-align:center;color:#999;padding:2.5rem 1rem;font-size:.95rem;}

    /* æ”¶è—æ¸…å–®è£¡çš„ã€Œç„¡ç´€éŒ„ã€æ¨™è¨˜ */
    .badge-none{
      color:#999;
      font-size:.8rem;
      font-weight:500;
      white-space:nowrap;
      flex-shrink:0;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Swipe Labels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .swipe-label{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      font-weight:800;
      opacity:0;
      transition:opacity .15s ease;
      pointer-events:none;
      z-index:2;
      user-select:none;
    }
    .swipe-label-left{
      left:1.1rem;
      color:var(--secondary);
      border:3px solid var(--secondary);
      padding:.2rem .7rem;
      border-radius:12px;
      font-size:1.55rem;
    }
    .swipe-label-right{
      right:1.1rem;
      color:var(--success);
      border:3px solid var(--success);
      padding:.2rem .7rem;
      border-radius:12px;
      font-size:1.55rem;
    }
    @keyframes flyLeft{0%{transform:translateX(0) rotate(0);opacity:1}100%{transform:translateX(-140%) rotate(-25deg);opacity:0}}
    @keyframes flyRight{0%{transform:translateX(0) rotate(0);opacity:1}100%{transform:translateX(140%) rotate(25deg);opacity:0}}
    .flashcard.fly-left{animation:flyLeft .4s ease forwards;}
    .flashcard.fly-right{animation:flyRight .4s ease forwards;}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Welcome â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .welcome-page{
      min-height:calc(100vh - 2rem);
      display:flex;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding:2.2rem 1.2rem;
    }
    .welcome-card{
      background:transparent;
      border-radius:0;
      padding:0;
      box-shadow:none;
      width:100%;
      max-width:680px;
    }
    .welcome-icon{font-size:3.2rem;margin-bottom:.35rem;}
    .welcome-title{
      font-weight:700;
      color:var(--primary);
      margin-bottom:1.2rem;
      line-height:1.55;
    }
    .welcome-title .heart{color:#e84c6a;font-size:1.35rem;}
    .welcome-title-main{
      display:block;
      font-size:clamp(1.1rem,5.5vw,1.7rem);
    }
    .welcome-title .sparkle{color:var(--accent);}
    .welcome-desc{
      font-size:.95rem;
      color:#6b6b6b;
      line-height:1.85;
      margin-bottom:1.8rem;
    }
    .welcome-desc .highlight{color:var(--primary);font-weight:600;}
    .welcome-btn{
      display:inline-block;
      padding:.85rem 2.4rem;
      background:linear-gradient(135deg,var(--primary),#1e4a5f);
      color:#fff;
      border:none;
      border-radius:50px;
      font-size:1.05rem;
      font-weight:600;
      cursor:pointer;
      transition:all .25s ease;
      box-shadow:0 6px 20px rgba(44,95,124,.35);
    }
    .welcome-btn:hover{transform:translateY(-1px);box-shadow:0 10px 28px rgba(44,95,124,.45);}
    .powered-by{margin-top:1.6rem;font-size:.72rem;color:#bbb;letter-spacing:.5px}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Detail Popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .popup-overlay{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      z-index:500;
      justify-content:center;
      align-items:center;
      padding:1.5rem;
      -webkit-backdrop-filter:blur(3px);
      backdrop-filter:blur(3px);
    }
    .popup-overlay.open{display:flex;}
    .popup-card{
      background:#fff;
      border-radius:22px;
      max-width:480px;
      width:100%;
      max-height:85vh;
      overflow-y:auto;
      padding:1.6rem 1.4rem;
      box-shadow:0 24px 60px rgba(0,0,0,.2);
      position:relative;
      animation:popIn .25s ease;
    }
    @keyframes popIn{0%{opacity:0;transform:scale(.92)}100%{opacity:1;transform:scale(1)}}
    .popup-close{
      position:absolute;
      top:.6rem;right:.6rem;
      background:rgba(0,0,0,.06);
      border:none;
      border-radius:50%;
      width:2rem;height:2rem;
      font-size:1.1rem;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      color:#666;
      transition:background .15s;
    }
    .popup-close:hover{background:rgba(0,0,0,.13);}
    /* popup è£¡çš„æ”¶è— iconï¼ˆå·¦ä¸Šï¼‰ */
    .popup-fav-btn{
      position:absolute;
      top:.6rem;left:.6rem;
      background:rgba(255,255,255,.85);
      border:none;
      border-radius:50%;
      width:2rem;height:2rem;
      font-size:1.15rem;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
      transition:transform .2s ease, background .2s ease;
      color:#999;
      z-index:2;
    }
    .popup-fav-btn:hover{transform:scale(1.1);}
    .popup-fav-btn.is-fav{background:rgba(255,80,100,.9);color:#fff;}
    .popup-title-en{
      font-family:'Crimson Pro',serif;
      font-size:1.6rem;font-weight:700;
      color:var(--primary);text-align:center;
      margin-top:.2rem;
    }
    .popup-title-zh{
      font-size:1rem;color:var(--secondary);
      text-align:center;font-weight:500;margin-bottom:.7rem;
    }
    .popup-img{
      display:block;
      max-width:100%;max-height:200px;
      object-fit:contain;
      border-radius:12px;
      box-shadow:0 4px 16px rgba(0,0,0,.1);
      margin:0 auto .9rem;
    }
    .popup-info-item{
      padding:.6rem 0;
      border-bottom:1px solid var(--border);
    }
    .popup-info-item:last-child{border-bottom:none;}
    .popup-info-label{font-weight:700;color:var(--primary);font-size:.82rem;margin-bottom:.2rem;}
    .popup-info-content{color:var(--text);font-size:.88rem;line-height:1.55;white-space:pre-line;}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Mobile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width:768px){
      h1{font-size:2rem;}
      .flashcard{height:350px;}
      .card-face{padding:0.9rem;}
      .card-image{max-height:260px;}
      .card-title{font-size:1.2rem;}
      .card-subtitle{font-size:1.1rem;}

      .controls{padding:.6rem .75rem;margin-bottom:.8rem;}
      .filter-sub-group{gap:.4rem;}
      .filter-btn{padding:.4rem .2rem;font-size:.76rem;}
      .filter-btn-all{padding:.5rem .9rem;font-size:.92rem;}

      .actions{gap:.7rem;}
      .action-btn{padding:.8rem .45rem;font-size:.95rem;}

      .stats-summary{gap:.6rem;}
      .stats-card{padding:.9rem .5rem;border-radius:12px;}
      .stats-card .num{font-size:1.8rem;}
      .stats-card .label{font-size:.75rem;}
      .stats-title{font-size:1.5rem;margin-bottom:1rem;}
      .stats-section h3{font-size:1.1rem;}

      .stats-list-item{padding:.7rem .6rem;flex-wrap:wrap;gap:.5rem;}
      .stats-list-item img{width:60px;height:60px;margin-right:.7rem;}
      .stats-list-item .name-en{font-size:.88rem;}
      .stats-list-item .name-zh{font-size:.78rem;}
      .stats-list-item .badge{font-size:.72rem;padding:.3rem .7rem;}

      .popup-card{padding:1.2rem 1rem;}
      .popup-title-en{font-size:1.35rem;}
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- Welcome Page -->
    <div id="welcomePage" class="welcome-page">
      <div class="welcome-card">
        <div class="welcome-icon">ğŸ’ª</div>
        <div class="welcome-title">
          <span class="heart">â¤ï¸</span> ä½ å¥½~<br>
          <span class="welcome-title-main">é€™è£¡æ˜¯è‚Œè‚‰è§£å‰–å­¸çš„<span class="sparkle">è¤‡ç¿’å°å¤©å ‚</span>ğŸ’«</span>
        </div>
        <p class="welcome-desc">
          å¸Œæœ›ä½ å¯ä»¥ä»¥<span class="highlight">è¼•é¬†äº¤å‹</span>çš„æ–¹å¼<br>
          å¿«é€Ÿè¤‡ç¿’è§£å‰–å­¸çš„ç›¸é—œçŸ¥è­˜<br><br>
          å¿«ä¾†è©¦è©¦ä¾†å°‹æ‰¾ä½ çš„<span class="highlight">è‚Œå‘½å¤©å­</span>å§ï½
        </p>

        <button class="welcome-btn" id="btnStart">é–‹å§‹è¤‡ç¿’ â€º</button>
        <p class="powered-by">Powered by Luga</p>
      </div>
    </div>

    <!-- Main Header -->
    <div class="header" id="mainHeader">
      <h1>Musculature Heaven</h1>
    </div>

    <!-- Stats entry -->
    <div class="stats-entry-top" id="statsEntryTop">
      <button class="stats-btn" id="btnStats">ğŸ“Š æˆ‘çš„å­¸ç¿’æˆæ•ˆ</button>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading" style="display:none;">
      <div class="spinner"></div>
      <p>è¼‰å…¥è³‡æ–™ä¸­...</p>
    </div>

    <!-- Empty message -->
    <div id="emptyMsg" class="empty-msg">
      <div class="emoji">ğŸ“­</div>
      <p>ä½ é‚„æ²’æœ‰ç´€éŒ„å–”</p>
      <p class="sub">3 ç§’å¾Œè‡ªå‹•å›åˆ°å…¨éƒ¨...</p>
    </div>

    <!-- Main App -->
    <div id="app" style="display:none;">

      <div class="card-container">
        <!-- æ”¶è— iconï¼ˆæµ®åœ¨ card-container å·¦ä¸Šï¼Œä¸éš¨ç¿»è½‰å‹•ï¼‰ -->
        <button class="fav-icon-btn" id="favIconBtn" aria-label="æ”¶è—">â™¡</button>

        <div class="flashcard" id="flashcard">
          <div class="swipe-label swipe-label-left" id="swipeLeft">âŒ é‚„ä¸ç†Ÿ</div>
          <div class="swipe-label swipe-label-right" id="swipeRight">âœ… ç†Ÿæ‚‰äº†</div>

          <div class="card-face card-front">
            <img id="cardImage" class="card-image" alt="Muscle" style="max-height:85%;margin:0;">
            <div class="flip-hint">ğŸ‘† é»æ“Šç¿»è½‰æŸ¥çœ‹è³‡è¨Š</div>
          </div>

          <div class="card-face card-back">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:.9rem;width:100%;margin-bottom:.55rem;">
              <div style="display:flex;align-items:center;justify-content:center;">
                <img id="cardImageBack" class="card-image" alt="Muscle" style="max-height:120px;margin:0;">
              </div>
              <div style="display:flex;flex-direction:column;justify-content:center;">
                <h2 class="card-title" id="cardTitleEN">Muscle Name</h2>
                <p class="card-subtitle" id="cardTitleZH">è‚Œè‚‰åç¨±</p>
              </div>
            </div>
            <div class="card-info" id="cardInfo"></div>
            <div class="flip-hint">ğŸ‘† é»æ“Šç¿»å›æ­£é¢</div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="action-btn btn-unfamiliar" id="btnUnfamiliar">âŒ é‚„ä¸ç†Ÿ</button>
        <button class="action-btn btn-familiar" id="btnFamiliar">âœ… ç†Ÿæ‚‰äº†</button>
      </div>

      <div class="controls">
        <div class="filter-buttons">
          <div class="filter-sub-group">
            <button class="filter-btn" data-filter="unfamiliar">
              <span class="filter-label">âŒ é‚„ä¸ç†Ÿ</span>
              <span class="filter-count" id="countUnfamiliar">0</span>
            </button>
            <button class="filter-btn" data-filter="familiar">
              <span class="filter-label">âœ… ç†Ÿæ‚‰äº†</span>
              <span class="filter-count" id="countFamiliar">0</span>
            </button>
            <button class="filter-btn" data-filter="unseen">
              <span class="filter-label">ğŸ‘€ é‚„æ²’çœ‹</span>
              <span class="filter-count" id="countUnseen">0</span>
            </button>
          </div>

          <button class="filter-btn-all active" data-filter="all">
            <span>å…¨éƒ¨</span>
            <span class="filter-count" id="countAll">0</span>
          </button>

          <!-- æ”¶è—å…¥å£ -->
          <button class="fav-entry-btn" id="btnFavEntry">
            ğŸ”– æˆ‘çš„æ”¶è—
            <span class="fav-count" id="favCount"></span>
          </button>
        </div>
      </div>

    </div><!-- /app -->

    <!-- Stats Page -->
    <div id="statsPage" class="stats-page">
      <div class="stats-page-inner">
        <div class="stats-header">
          <button class="nav-btn" id="btnBackToMain">â† è¿”å›ä¸»é </button>
        </div>
        <h2 class="stats-title">ğŸ“Š æˆ‘çš„å­¸ç¿’æˆæ•ˆ</h2>
        <div class="stats-summary">
          <div class="stats-card" style="background:linear-gradient(135deg,var(--primary),#1e4a5f);">
            <div class="num" id="statsTotal">0</div><div class="label">ç¸½é¡Œæ•¸</div>
          </div>
          <div class="stats-card" style="background:linear-gradient(135deg,var(--success),#45a049);">
            <div class="num" id="statsFamiliar">0</div><div class="label">å·²ç†Ÿæ‚‰</div>
          </div>
          <div class="stats-card" style="background:linear-gradient(135deg,var(--secondary),#6d3d39);">
            <div class="num" id="statsUnfamiliar">0</div><div class="label">é‚„ä¸ç†Ÿ</div>
          </div>
        </div>
        <div class="stats-section">
          <h3 style="color:var(--secondary);">âŒ æˆ‘æœ€å¸¸éŒ¯çš„ï¼ˆå‰ 10 åï¼‰</h3>
          <div id="mostWrongList"></div>
        </div>
        <div class="stats-section">
          <h3 style="color:var(--success);">âœ… æˆ‘æœ€ç†Ÿçš„ï¼ˆå‰ 10 åï¼‰</h3>
          <div id="mostCorrectList"></div>
        </div>
        <div class="clear-section">
          <button class="clear-btn" id="btnClear">ğŸ—‘ï¸ æ¸…ç©ºç´€éŒ„</button>
        </div>
      </div>
    </div>

    <!-- Favorites Page -->
    <div id="favPage" class="fav-page">
      <div class="fav-page-inner">
        <div class="stats-header">
          <button class="nav-btn" id="btnFavBack">â† è¿”å›ä¸»é </button>
        </div>
        <h2 class="stats-title">ğŸ”– æˆ‘çš„æ”¶è—</h2>
        <div id="favList"></div>
      </div>
    </div>

  </div><!-- /container -->

  <!-- Detail Popup -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup-card">
      <button class="popup-fav-btn" id="popupFavBtn" aria-label="æ”¶è—">â™¡</button>
      <button class="popup-close" id="popupClose">âœ•</button>
      <div class="popup-title-en" id="popupTitleEN"></div>
      <div class="popup-title-zh" id="popupTitleZH"></div>
      <img class="popup-img" id="popupImg" alt="Muscle">
      <div id="popupInfos"></div>
    </div>
  </div>

  <script>
    const RAW_BASE    = '';
    const CSV_PATH    = 'data/muscles.csv';
    const IMG_PATH    = 'images/';

    // imgURL helperï¼ˆè™•ç†ç©ºæ ¼ã€æ‹¬è™Ÿç­‰ç‰¹æ®Šå­—å…ƒï¼‰
    function imgURL(fn){ return IMG_PATH + fn.split('/').map(encodeURIComponent).join('/'); }

    let allCards      = [];
    let cardQueue     = [];
    let currentIndex  = 0;
    let currentFilter = 'all';
    let familiarityData = {};   // { fn: 'unseen'|'unfamiliar'|'familiar' }
    let statsData       = {};   // { fn: { wrong, correct, nameEN, nameZH, image } }
    let favData         = {};   // { fn: { addedAt } }   æ”¶è—æ™‚é–“æˆ³

    // â”€â”€â”€ showPage â”€â”€â”€
    function showPage(name){
      const els = {
        welcome:  document.getElementById('welcomePage'),
        loading:  document.getElementById('loading'),
        app:      document.getElementById('app'),
        stats:    document.getElementById('statsPage'),
        fav:      document.getElementById('favPage'),
        header:   document.getElementById('mainHeader'),
        statsTop: document.getElementById('statsEntryTop'),
        emptyMsg: document.getElementById('emptyMsg')
      };
      // hide all
      Object.values(els).forEach(el=>{ if(el) el.style.display='none'; });

      if(name==='welcome'){
        els.welcome.style.display='flex';
      }else if(name==='loading'){
        els.loading.style.display='block';
        els.header.style.display='block';
      }else if(name==='app'){
        els.app.style.display='block';
        els.header.style.display='block';
        els.statsTop.style.display='flex';
      }else if(name==='stats'){
        els.stats.style.display='block';
        els.header.style.display='block';
      }else if(name==='fav'){
        els.fav.style.display='block';
        els.header.style.display='block';
      }
    }

    // â”€â”€â”€ localStorage â”€â”€â”€
    function loadSaved(){
      try{ familiarityData = JSON.parse(localStorage.getItem('musculature_familiarity')) || {}; }catch(e){}
      try{ statsData       = JSON.parse(localStorage.getItem('musculature_stats'))       || {}; }catch(e){}
      try{ favData          = JSON.parse(localStorage.getItem('musculature_favs'))        || {}; }catch(e){}
    }
    function saveSaved(){
      localStorage.setItem('musculature_familiarity', JSON.stringify(familiarityData));
      localStorage.setItem('musculature_stats',       JSON.stringify(statsData));
      localStorage.setItem('musculature_favs',        JSON.stringify(favData));
    }

    // â”€â”€â”€ CSV â”€â”€â”€
    function parseCSV(text){
      text = text.replace(/\r\n/g,'\n').replace(/\r/g,'\n');
      const lines = text.split('\n');
      const headers = parseCSVLine(lines[0]);
      const data = [];
      let i = 1;
      while(i < lines.length){
        if(!lines[i].trim()){ i++; continue; }
        let row = lines[i];
        let qc = (row.match(/"/g)||[]).length;
        while(qc % 2 !== 0 && i+1 < lines.length){ i++; row += '\n' + lines[i]; qc = (row.match(/"/g)||[]).length; }
        const vals = parseCSVLine(row);
        if(vals.length === headers.length){
          const obj = {};
          headers.forEach((h,idx)=> obj[h]=vals[idx]);
          data.push(obj);
        }
        i++;
      }
      return data;
    }
    function parseCSVLine(line){
      const vals=[]; let cur='',inQ=false;
      for(let i=0;i<line.length;i++){
        const ch=line[i];
        if(ch==='"'){ if(inQ&&line[i+1]==='"'){cur+='"';i++;}else inQ=!inQ; }
        else if(ch===','&&!inQ){ vals.push(cur.trim()); cur=''; }
        else cur+=ch;
      }
      vals.push(cur.trim());
      return vals;
    }

    // â”€â”€â”€ loadData â”€â”€â”€
    async function loadData(){
      try{
        const res  = await fetch(RAW_BASE + CSV_PATH);
        const text = await res.text();
        allCards   = parseCSV(text);
        allCards.forEach(c=>{ if(!familiarityData[c['picture file']]) familiarityData[c['picture file']]='unseen'; });
        applyFilter();
        updateProgress();
        updateFavBadge();
        showCard(0);
        showPage('app');
      }catch(err){
        document.getElementById('loading').innerHTML =
          `<p style="color:#c00;">è¼‰å…¥å¤±æ•—ï¼</p><p style="font-size:.9rem;margin-top:.5rem;">${err.message}</p>`;
      }
    }

    // â”€â”€â”€ shuffle â”€â”€â”€
    function shuffleArray(arr){
      const a=[...arr];
      for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    }

    // â”€â”€â”€ applyFilter â”€â”€â”€
    function applyFilter(){
      const filtered = currentFilter === 'all'
        ? [...allCards]
        : allCards.filter(c => familiarityData[c['picture file']] === currentFilter);
      cardQueue    = shuffleArray(filtered);
      currentIndex = 0;
    }

    /*
     * â”€â”€â”€ è¤‡ç¿’æ’å…¥ï¼ˆä¿®æ­£ç‰ˆï¼‰ â”€â”€â”€
     * ç•¶ä½¿ç”¨è€…é»ã€Œé‚„ä¸ç†Ÿã€æ™‚ï¼Œå°‡è©²å¼µå¡æ’å…¥åˆ°éšŠåˆ—ä¸­ã€Œ7å¼µå¾Œã€çš„ä½ç½®ã€‚
     * ä½†å¦‚æœéšŠåˆ—è£¡å¾ç•¶å‰ä½ç½®åˆ°æœ«å°¾éƒ½æ˜¯ã€Œä¸ç†Ÿã€çš„å¡ï¼Œæœƒé€ æˆæ­»è¿´åœˆã€‚
     * ä¿®æ­£ï¼šæ’å…¥æ™‚ç¢ºä¿ä¸­é–“è‡³å°‘ç©¿æ’ä¸€å¼µã€Œéä¸ç†Ÿã€çš„å¡ï¼ˆunseen / familiarï¼‰ã€‚
     * åšæ³•ï¼šå¾ currentIndex+1 é–‹å§‹å¾€å¾Œæ‰¾ï¼Œè·³éé€£çºŒçš„ unfamiliarï¼Œ
     *       æ’å…¥ä½ç½®ç‚º min(ç¬¬ä¸€å¼µé unfamiliar ä¹‹å¾Œ + 6, éšŠåˆ—æœ«å°¾)ã€‚
     *       å¦‚æœæ‰¾ä¸åˆ°é unfamiliarï¼Œå°±ä¸æ’å…¥ï¼ˆæ²’åˆ¥çš„å¯ç©¿æ’äº†ï¼‰ã€‚
     */
    function insertReviewCard(card){
      const start = currentIndex + 1;
      // æ‰¾åˆ°ç¬¬ä¸€å¼µã€Œä¸æ˜¯ unfamiliarã€çš„ä½ç½®
      let firstNonUnfam = -1;
      for(let i = start; i < cardQueue.length; i++){
        if(familiarityData[cardQueue[i]['picture file']] !== 'unfamiliar'){
          firstNonUnfam = i;
          break;
        }
      }
      if(firstNonUnfam === -1) return; // å¾Œé¢å…¨æ˜¯ unfamiliarï¼Œä¸æ’å…¥é¿å…æ­»è¿´åœˆ

      // æ’å…¥é»ï¼šåœ¨ç¬¬ä¸€å¼µé unfamiliar ä¹‹å¾Œå†éš” 6 å¼µï¼ˆç¸½å…±ç©¿é 7 å¼µå†å‡ºç¾ï¼‰
      // ä½†ä¸è¶…ééšŠåˆ—é•·åº¦
      const insertAt = Math.min(firstNonUnfam + 7, cardQueue.length);
      cardQueue.splice(insertAt, 0, card);
    }

    // â”€â”€â”€ FALLBACK â”€â”€â”€
    const FALLBACK_IMG = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="300" height="200" fill="%23ddd"/><text x="150" y="100" text-anchor="middle" fill="%23999" font-size="16">åœ–ç‰‡è¼‰å…¥å¤±æ•—</text></svg>';

    // â”€â”€â”€ showCard â”€â”€â”€
    function showCard(idx){
      if(!cardQueue.length) return;
      const card = cardQueue[idx];
      const fn   = card['picture file'];
      const url  = imgURL(fn);

      ['cardImage','cardImageBack'].forEach(id=>{
        const el = document.getElementById(id);
        el.src = url;
        el.onerror = function(){ this.src = FALLBACK_IMG; };
      });

      document.getElementById('cardTitleEN').textContent = card['name (EN)'] || '';
      document.getElementById('cardTitleZH').textContent = card['name (CN)'] || '';

      document.getElementById('cardInfo').innerHTML = [
        ['Origin / èµ·å§‹é»',    card['Origin'],    card['èµ·å§‹é»']],
        ['Insertion / çµæŸé»', card['Insertion'], card['çµæŸé»']],
        ['Action / å‹•ä½œ',      card['Action'],    card['å‹•ä½œ']],
        ['Nerve / ç¥ç¶“æ”¯é…',   card['Nerve'],     card['ç¥ç¶“æ”¯é…']]
      ].map(([label,en,zh]) =>
        `<div class="info-item"><div class="info-label">${label}</div><div class="info-content">${en||''}\n${zh||''}</div></div>`
      ).join('');

      const flash = document.getElementById('flashcard');
      flash.classList.remove('flipped','fly-left','fly-right');
      flash.style.transform  = '';
      flash.style.transition = '';

      const isFam = familiarityData[fn] === 'familiar';
      document.getElementById('btnFamiliar').style.opacity   = isFam ? '1' : '0.55';
      document.getElementById('btnUnfamiliar').style.opacity = isFam ? '0.55' : '1';

      // æ›´æ–°æ”¶è— icon ç‹€æ…‹
      updateFavIcon(fn);
    }

    // â”€â”€â”€ updateProgress â”€â”€â”€
    function updateProgress(){
      const total = allCards.length;
      const fam   = allCards.filter(c => familiarityData[c['picture file']] === 'familiar').length;
      const unfam = allCards.filter(c => familiarityData[c['picture file']] === 'unfamiliar').length;
      document.getElementById('countAll').textContent        = total;
      document.getElementById('countFamiliar').textContent   = fam;
      document.getElementById('countUnfamiliar').textContent = unfam;
      document.getElementById('countUnseen').textContent     = total - fam - unfam;
    }

    // â”€â”€â”€ æ”¶è— helpers â”€â”€â”€
    function updateFavIcon(fn){
      const btn = document.getElementById('favIconBtn');
      if(favData[fn]){
        btn.classList.add('is-fav');
        btn.innerHTML = 'â™¥';
      }else{
        btn.classList.remove('is-fav');
        btn.innerHTML = 'â™¡';
      }
    }
    function updateFavBadge(){
      const count = Object.keys(favData).length;
      document.getElementById('favCount').textContent = count > 0 ? `(${count})` : '';
    }
    function toggleFav(){
      if(!cardQueue.length) return;
      const fn = cardQueue[currentIndex]['picture file'];
      if(favData[fn]){
        delete favData[fn];
      }else{
        favData[fn] = { addedAt: Date.now() };
      }
      saveSaved();
      updateFavIcon(fn);
      updateFavBadge();
    }

    // â”€â”€â”€ æ”¶è—é é¢ â”€â”€â”€
    function showFavPage(){
      showPage('fav');

      // å¾ allCards è£¡æ‰¾åˆ°æ‰€æœ‰åœ¨ favData è£¡çš„å¡
      const favCards = allCards.filter(c => favData[c['picture file']]);

      // æ’åºè¦å‰‡ï¼š
      // 1. æœ‰ç´€éŒ„çš„åœ¨å‰ï¼ŒæŒ‰ wrong æ¬¡æ•¸é™åº
      // 2. wrong ç›¸åŒæ™‚ï¼ŒæŒ‰ correct æ¬¡æ•¸å‡åºï¼ˆcorrect æœ€é«˜æ”¾æœ€ä¸‹é¢ï¼‰
      // 3. ç„¡ç´€éŒ„çš„æ”¾æœ€å¾Œï¼ŒæŒ‰ addedAt å‡åº
      const withStats = [];
      const noStats   = [];

      favCards.forEach(c => {
        const fn = c['picture file'];
        const s  = statsData[fn];
        if(s && (s.wrong > 0 || s.correct > 0)){
          withStats.push({ card: c, fn, stats: s });
        }else{
          noStats.push({ card: c, fn });
        }
      });

      withStats.sort((a,b) => {
        if(b.stats.wrong !== a.stats.wrong) return b.stats.wrong - a.stats.wrong; // wrong é«˜çš„å…ˆ
        return a.stats.correct - b.stats.correct; // correct ä½çš„å…ˆï¼ˆé«˜çš„æ”¾æœ€ä¸‹é¢ï¼‰
      });

      noStats.sort((a,b) => (favData[a.fn].addedAt || 0) - (favData[b.fn].addedAt || 0));

      const sorted = [...withStats, ...noStats];

      if(sorted.length === 0){
        document.getElementById('favList').innerHTML =
          '<p class="fav-list-empty">é‚„æ²’æœ‰æ”¶è—ä»»ä½•å…§å®¹å“¦ï½<br>çœ‹åˆ°å–œæ­¡çš„è‚Œè‚‰é»å·¦ä¸Šçš„ â™¡ æ”¶è—å§ï¼</p>';
        return;
      }

      document.getElementById('favList').innerHTML = sorted.map(item => {
        const fn    = item.fn;
        const card  = item.card;
        const url   = imgURL(fn);
        const s     = statsData[fn];
        const hasRecord = s && (s.wrong > 0 || s.correct > 0);

        let badgeHTML;
        if(hasRecord){
          badgeHTML = `<span class="badge" style="background:var(--secondary);">éŒ¯ ${s.wrong} æ¬¡</span>`;
        }else{
          badgeHTML = `<span class="badge-none">ç„¡ç´€éŒ„</span>`;
        }

        return `
          <div class="stats-list-item" data-fn="${fn}">
            <img src="${url}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2275%22 height=%2275%22><rect width=%2275%22 height=%2275%22 fill=%22%23ddd%22/></svg>'">
            <div class="info">
              <div class="name-en">${card['name (EN)'] || ''}</div>
              <div class="name-zh">${card['name (CN)'] || ''}</div>
            </div>
            ${badgeHTML}
          </div>`;
      }).join('');

      // é»æ“Šæ¸…å–®é …ç›®é–‹å•Ÿ popup
      document.querySelectorAll('#favList .stats-list-item').forEach(el => {
        el.addEventListener('click', () => openPopup(el.dataset.fn));
      });
    }

    // â”€â”€â”€ Stats é é¢ â”€â”€â”€
    function showStatsPage(){
      showPage('stats');

      document.getElementById('statsTotal').textContent     = allCards.length;
      document.getElementById('statsFamiliar').textContent   = allCards.filter(c => familiarityData[c['picture file']]==='familiar').length;
      document.getElementById('statsUnfamiliar').textContent = allCards.filter(c => familiarityData[c['picture file']]==='unfamiliar').length;

      const renderList = (id, key, label, bg) => {
        const list = Object.values(statsData).filter(s=>s[key]>0).sort((a,b)=>b[key]-a[key]).slice(0,10);
        document.getElementById(id).innerHTML = list.length
          ? list.map(item => `
              <div class="stats-list-item" data-fn="${item.image}" style="cursor:pointer;">
                <img src="${imgURL(item.image)}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2275%22 height=%2275%22><rect width=%2275%22 height=%2275%22 fill=%22%23ddd%22/></svg>'">
                <div class="info"><div class="name-en">${item.nameEN}</div><div class="name-zh">${item.nameZH}</div></div>
                <div class="badge" style="background:${bg};">${label} ${item[key]} æ¬¡</div>
              </div>`).join('')
          : '<p class="stats-empty">é‚„æ²’æœ‰ç´€éŒ„</p>';

        // é»æ“Šé–‹å•Ÿ popup
        document.querySelectorAll(`#${id} .stats-list-item`).forEach(el => {
          el.addEventListener('click', () => openPopup(el.dataset.fn));
        });
      };
      renderList('mostWrongList',   'wrong',   'éŒ¯èª¤', 'var(--secondary)');
      renderList('mostCorrectList', 'correct', 'æ­£ç¢º', 'var(--success)');
    }

    // â”€â”€â”€ Detail Popup â”€â”€â”€
    let currentPopupFn = null;   // ç•¶å‰é–‹å•Ÿçš„ popup å°æ‡‰å“ªå¼µå¡

    function openPopup(fn){
      const card = allCards.find(c => c['picture file'] === fn);
      if(!card) return;
      currentPopupFn = fn;

      const url = imgURL(fn);
      document.getElementById('popupTitleEN').textContent = card['name (EN)'] || '';
      document.getElementById('popupTitleZH').textContent = card['name (CN)'] || '';

      const img = document.getElementById('popupImg');
      img.src = url;
      img.onerror = function(){ this.src = FALLBACK_IMG; };

      document.getElementById('popupInfos').innerHTML = [
        ['Origin / èµ·å§‹é»',    card['Origin'],    card['èµ·å§‹é»']],
        ['Insertion / çµæŸé»', card['Insertion'], card['çµæŸé»']],
        ['Action / å‹•ä½œ',      card['Action'],    card['å‹•ä½œ']],
        ['Nerve / ç¥ç¶“æ”¯é…',   card['Nerve'],     card['ç¥ç¶“æ”¯é…']]
      ].map(([label,en,zh]) =>
        `<div class="popup-info-item">
           <div class="popup-info-label">${label}</div>
           <div class="popup-info-content">${en||''}\n${zh||''}</div>
         </div>`
      ).join('');

      // è¨­å®š popup æ”¶è— icon ç‹€æ…‹
      const favBtn = document.getElementById('popupFavBtn');
      if(favData[fn]){
        favBtn.classList.add('is-fav');
        favBtn.innerHTML = 'â™¥';
      }else{
        favBtn.classList.remove('is-fav');
        favBtn.innerHTML = 'â™¡';
      }

      document.getElementById('popupOverlay').classList.add('open');
    }
    function closePopup(){
      document.getElementById('popupOverlay').classList.remove('open');
      currentPopupFn = null;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DOMContentLoaded â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', ()=>{
      loadSaved();
      showPage('welcome');

      document.getElementById('btnStart').addEventListener('click', ()=>{
        if(allCards.length === 0){
          showPage('loading');
          loadData();
        }else{
          currentFilter = 'all';
          document.querySelectorAll('.filter-btn-all,.filter-btn').forEach(b=>b.classList.remove('active'));
          document.querySelector('[data-filter="all"]').classList.add('active');
          applyFilter(); showCard(0); showPage('app');
        }
      });

      // â”€â”€ ç¿»ç‰Œ click â”€â”€
      document.getElementById('flashcard').addEventListener('click', ()=>{
        if(window._swipeEndedAsDrag){ window._swipeEndedAsDrag = false; return; }
        document.getElementById('flashcard').classList.toggle('flipped');
      });

      // â”€â”€ æ”¶è— icon é»æ“Šï¼ˆé˜»æ­¢å†’æ³¡ï¼Œé¿å…è§¸ç™¼ç¿»ç‰Œï¼‰ â”€â”€
      document.getElementById('favIconBtn').addEventListener('click', e => {
        e.stopPropagation();
        toggleFav();
      });

      // â”€â”€ ç¯©é¸å™¨ â”€â”€
      const allBtns = document.querySelectorAll('.filter-btn-all,.filter-btn');
      allBtns.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const f = btn.dataset.filter;
          if(f !== 'all'){
            const cnt = allCards.filter(c => familiarityData[c['picture file']] === f).length;
            if(cnt === 0){
              document.getElementById('app').style.display = 'none';
              document.getElementById('statsEntryTop').style.display = 'none';
              document.getElementById('emptyMsg').style.display = 'block';
              setTimeout(()=>{
                document.getElementById('emptyMsg').style.display = 'none';
                allBtns.forEach(b=>b.classList.remove('active'));
                document.querySelector('[data-filter="all"]').classList.add('active');
                currentFilter = 'all';
                applyFilter(); showCard(0); showPage('app');
              }, 3000);
              return;
            }
          }
          allBtns.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = f;
          applyFilter(); showCard(0);
        });
      });

      // â”€â”€ é‚„ä¸ç†Ÿ â”€â”€
      document.getElementById('btnUnfamiliar').addEventListener('click', ()=>{
        const card = cardQueue[currentIndex];
        const fn   = card['picture file'];
        familiarityData[fn] = 'unfamiliar';
        if(!statsData[fn]) statsData[fn] = { wrong:0, correct:0, nameEN:card['name (EN)'], nameZH:card['name (CN)'], image:fn };
        statsData[fn].wrong++;
        saveSaved(); updateProgress();
        if(currentFilter === 'all') insertReviewCard(card);
        if(currentIndex < cardQueue.length-1){ currentIndex++; showCard(currentIndex); }
        else showCard(currentIndex);
      });

      // â”€â”€ ç†Ÿæ‚‰äº† â”€â”€
      document.getElementById('btnFamiliar').addEventListener('click', ()=>{
        const card = cardQueue[currentIndex];
        const fn   = card['picture file'];
        familiarityData[fn] = 'familiar';
        if(!statsData[fn]) statsData[fn] = { wrong:0, correct:0, nameEN:card['name (EN)'], nameZH:card['name (CN)'], image:fn };
        statsData[fn].correct++;
        saveSaved(); updateProgress();
        if(currentIndex < cardQueue.length-1){ currentIndex++; showCard(currentIndex); }
        else showCard(currentIndex);
      });

      // â”€â”€ å­¸ç¿’æˆæ•ˆ â”€â”€
      document.getElementById('btnStats').addEventListener('click', showStatsPage);
      document.getElementById('btnBackToMain').addEventListener('click', ()=> showPage('app'));

      // â”€â”€ æ”¶è—é  â”€â”€
      document.getElementById('btnFavEntry').addEventListener('click', showFavPage);
      document.getElementById('btnFavBack').addEventListener('click', ()=> showPage('app'));

      // â”€â”€ æ¸…ç©ºç´€éŒ„ â”€â”€
      document.getElementById('btnClear').addEventListener('click', ()=>{
        if(!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ\né€™æœƒæŠŠç†Ÿæ‚‰åº¦å’Œå­¸ç¿’çµ±è¨ˆå…¨éƒ¨åˆªæ‰ï¼Œå¾é ­ä¾†éã€‚\nï¼ˆæ”¶è—ä¸æœƒè¢«åˆªé™¤ï¼‰')) return;
        familiarityData = {};
        statsData = {};
        localStorage.removeItem('musculature_familiarity');
        localStorage.removeItem('musculature_stats');
        allCards.forEach(c => familiarityData[c['picture file']] = 'unseen');
        saveSaved(); updateProgress();
        showPage('welcome');
      });

      // â”€â”€ Popup é—œé–‰ â”€â”€
      document.getElementById('popupClose').addEventListener('click', closePopup);
      document.getElementById('popupOverlay').addEventListener('click', e => {
        if(e.target === document.getElementById('popupOverlay')) closePopup();
      });

      // popup è£¡çš„æ”¶è— icon
      document.getElementById('popupFavBtn').addEventListener('click', ()=>{
        if(!currentPopupFn) return;
        const fn = currentPopupFn;
        const favBtn = document.getElementById('popupFavBtn');

        if(favData[fn]){
          // å–æ¶ˆæ”¶è—
          delete favData[fn];
          favBtn.classList.remove('is-fav');
          favBtn.innerHTML = 'â™¡';
        }else{
          // åŠ å…¥æ”¶è—
          favData[fn] = { addedAt: Date.now() };
          favBtn.classList.add('is-fav');
          favBtn.innerHTML = 'â™¥';
        }
        saveSaved();
        updateFavBadge();

        // å¦‚æœç•¶å‰åœ¨çœ‹æ”¶è—é ï¼Œåˆ·æ–°æ¸…å–®
        if(document.getElementById('favPage').style.display !== 'none'){
          showFavPage();
        }
        // å¦‚æœç•¶å‰åœ¨çœ‹ä¸»é å¡ç‰‡ï¼Œä¹Ÿæ›´æ–°ä¸»é çš„æ”¶è— icon
        if(cardQueue.length && cardQueue[currentIndex]['picture file'] === fn){
          updateFavIcon(fn);
        }
      });

      // â”€â”€â”€ Swipe â”€â”€â”€
      (function initSwipe(){
        const card   = document.getElementById('flashcard');
        const labelL = document.getElementById('swipeLeft');
        const labelR = document.getElementById('swipeRight');
        const THRESHOLD = 80;
        const DRAG_MIN  = 12;

        let startX=0,startY=0,curX=0;
        let state='idle';
        window._swipeEndedAsDrag = false;

        function onStart(x,y){
          if(card.classList.contains('fly-left')||card.classList.contains('fly-right')) return;
          startX=x; startY=y; curX=0;
          state='deciding';
          window._swipeEndedAsDrag = false;
        }
        function onMove(x,y){
          if(state==='idle'||state==='cancelled') return;
          const dx=x-startX, dy=y-startY;
          if(state==='deciding'){
            if(Math.sqrt(dx*dx+dy*dy)<DRAG_MIN) return;
            if(Math.abs(dy)>=Math.abs(dx)){ state='cancelled'; return; }
            state='dragging-h';
            card.style.transition='none';
          }
          curX=dx;
          const rot=Math.max(-18,Math.min(18,dx*0.04));
          card.style.transform = card.classList.contains('flipped')
            ? `rotateY(180deg) translateX(${-dx}px) rotate(${-rot}deg)`
            : `translateX(${dx}px) rotate(${rot}deg)`;
          const prog=Math.min(Math.abs(dx)/THRESHOLD,1);
          labelL.style.opacity = dx<0 ? prog : 0;
          labelR.style.opacity = dx>0 ? prog : 0;
        }
        function onEnd(){
          if(state==='idle'||state==='cancelled'){ state='idle'; return; }
          if(state==='deciding'){ state='idle'; return; }
          state='idle';
          window._swipeEndedAsDrag = true;
          labelL.style.opacity=0; labelR.style.opacity=0;

          if(curX < -THRESHOLD){
            card.style.transition='';
            card.classList.add('fly-left');
            card.addEventListener('animationend', ()=>{
              card.classList.remove('fly-left'); card.style.transform='';
              document.getElementById('btnUnfamiliar').click();
            }, { once:true });
          }else if(curX > THRESHOLD){
            card.style.transition='';
            card.classList.add('fly-right');
            card.addEventListener('animationend', ()=>{
              card.classList.remove('fly-right'); card.style.transform='';
              document.getElementById('btnFamiliar').click();
            }, { once:true });
          }else{
            card.style.transition='transform .35s cubic-bezier(.25,.8,.25,1)';
            card.style.transform = card.classList.contains('flipped') ? 'rotateY(180deg)' : '';
          }
        }

        card.addEventListener('touchstart', e=>onStart(e.touches[0].clientX,e.touches[0].clientY), {passive:true});
        card.addEventListener('touchmove', e=>{
          if(state==='dragging-h') e.preventDefault();
          onMove(e.touches[0].clientX,e.touches[0].clientY);
        }, {passive:false});
        card.addEventListener('touchend', onEnd);

        let mouseDragging=false;
        card.addEventListener('mousedown', e=>{ if(e.button!==0)return; mouseDragging=true; onStart(e.clientX,e.clientY); });
        window.addEventListener('mousemove', e=>{ if(!mouseDragging)return; onMove(e.clientX,e.clientY); });
        window.addEventListener('mouseup', ()=>{ if(mouseDragging){mouseDragging=false; onEnd();} });
      })();

      // â”€â”€ keyboard â”€â”€
      document.addEventListener('keydown', e=>{
        if(e.key==='ArrowLeft'){ e.preventDefault(); document.getElementById('btnUnfamiliar').click(); }
        else if(e.key==='ArrowRight'){ e.preventDefault(); document.getElementById('btnFamiliar').click(); }
        else if(e.key===' '){ e.preventDefault(); document.getElementById('flashcard').classList.toggle('flipped'); }
        else if(e.key==='Escape') closePopup();
      });
    });
  </script>
</body>
</html>
